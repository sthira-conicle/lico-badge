{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport * as THREE from \"three\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\nexport default {\n  name: \"LicoBadge\",\n  data() {\n    return {\n      threejs: null,\n      scene: null,\n      camera: null,\n      mixers: [],\n      neckBone: null,\n      mouse: new THREE.Vector2(),\n      rafId: null\n    };\n  },\n  props: {\n    width: {\n      type: Number,\n      default: 64\n    }\n  },\n  methods: {\n    initialize() {\n      // Create renderer\n      this.threejs = new THREE.WebGLRenderer({\n        antialias: true,\n        alpha: true // Enables transparency\n      });\n      this.threejs.shadowMap.enabled = true;\n      this.threejs.shadowMap.type = THREE.PCFSoftShadowMap;\n      this.threejs.setPixelRatio(window.devicePixelRatio);\n      this.threejs.setSize(width * 1.8, width * 1.8);\n      this.threejs.setClearColor(0x000000, 0);\n\n      // Attach renderer to DOM\n      this.$refs.threeContainer.appendChild(this.threejs.domElement);\n\n      // Camera setup\n      const fov = 50;\n      const aspect = 1;\n      const near = 1;\n      const far = 1000.0;\n      this.camera = new THREE.PerspectiveCamera(fov, aspect, near, far);\n      this.camera.position.set(0, 0.5, 2.3);\n      this.camera.lookAt(new THREE.Vector3(0, 0.6, 0));\n\n      // Scene setup\n      this.scene = new THREE.Scene();\n      this.scene.background = null; // Ensures transparency\n\n      // Lights\n      let light = new THREE.DirectionalLight(0xFFFFFF, 4.0);\n      light.position.set(5, 10, 7.5);\n      light.target.position.set(0, 0, 0);\n      light.castShadow = true;\n      light.shadow.bias = 0;\n      light.shadow.mapSize.width = 2048;\n      light.shadow.mapSize.height = 2048;\n      light.shadow.camera.near = 1;\n      light.shadow.camera.far = 500;\n      light.shadow.camera.left = -5;\n      light.shadow.camera.right = 5;\n      light.shadow.camera.top = 5;\n      light.shadow.camera.bottom = -5;\n      this.scene.add(light);\n      light = new THREE.AmbientLight(0x846E62, 5.0);\n      this.scene.add(light);\n\n      // Load model\n      this.loadModel();\n\n      // Mouse move listener\n      this.threejs.domElement.addEventListener(\"mousemove\", this.onMouseMove, false);\n\n      // Start render loop\n      this.raf();\n    },\n    loadModel() {\n      const loader = new GLTFLoader();\n      console.log(loader);\n      loader.load(\"/lico-idle.glb\", gltf => {\n        gltf.scene.traverse(c => {\n          if (c.material) {\n            c.material.side = THREE.FrontSide;\n            c.material.depthWrite = true;\n          }\n          c.receiveShadow = true;\n          c.castShadow = c.name !== \"floor\";\n\n          // if (c.name && c.name == \"floor\") {\n          //   c.material.color.set(0x00ff00);\n          // }\n        });\n        const idsToRemove = [];\n        gltf.animations[0].tracks.forEach((t, i) => {\n          if (t.name.includes(\"mixamorigHead.quaternion\")) {\n            idsToRemove.push(i);\n          }\n        });\n        idsToRemove.forEach(i => {\n          gltf.animations[0].tracks.splice(i, 1);\n        });\n        this.scene.add(gltf.scene);\n        // this.scene.background = new THREE.Color(0xffffff, 0);\n        // this.renderer.setClearColor(0xffffff, 0);\n\n        this.neckBone = gltf.scene.getObjectByName(\"mixamorigHead\");\n        if (gltf.animations.length > 0) {\n          const mixer = new THREE.AnimationMixer(gltf.scene);\n          const action = mixer.clipAction(gltf.animations[0]);\n          action.play();\n\n          // Update the mixer on every frame\n          this.mixers = [mixer];\n        }\n      });\n    },\n    onMouseMove(event) {\n      this.mouse.set(event.clientX / event.currentTarget.clientWidth * 2 - 1, -(event.clientY / event.currentTarget.clientHeight) * 2 + 1);\n      if (this.neckBone) {\n        this.neckBone.lookAt(this.mouse.x / 2, (this.mouse.y + 0.8) / 2, 1);\n      }\n    },\n    raf() {\n      this.rafId = requestAnimationFrame(t => {\n        if (this.previousRAF === null) {\n          this.previousRAF = t;\n        }\n        this.raf();\n        const timeElapsed = t - this.previousRAF;\n        this.previousRAF = t;\n        this._Step(timeElapsed);\n        this.threejs.render(this.scene, this.camera);\n      });\n    },\n    _Step(timeElapsed) {\n      const delta = timeElapsed * 0.001;\n      if (this.mixers.length > 0) {\n        this.mixers[0].update(delta);\n      }\n    },\n    cleanup() {\n      cancelAnimationFrame(this.rafId);\n      this.threejs.domElement.removeEventListener(\"mousemove\", this.onMouseMove);\n      this.threejs.dispose();\n      this.scene = null;\n      this.camera = null;\n      this.mixers = [];\n    }\n  },\n  mounted() {\n    this.initialize();\n  },\n  beforeUnmount() {\n    this.cleanup();\n  }\n};","map":{"version":3,"names":["THREE","GLTFLoader","name","data","threejs","scene","camera","mixers","neckBone","mouse","Vector2","rafId","props","width","type","Number","default","methods","initialize","WebGLRenderer","antialias","alpha","shadowMap","enabled","PCFSoftShadowMap","setPixelRatio","window","devicePixelRatio","setSize","setClearColor","$refs","threeContainer","appendChild","domElement","fov","aspect","near","far","PerspectiveCamera","position","set","lookAt","Vector3","Scene","background","light","DirectionalLight","target","castShadow","shadow","bias","mapSize","height","left","right","top","bottom","add","AmbientLight","loadModel","addEventListener","onMouseMove","raf","loader","console","log","load","gltf","traverse","c","material","side","FrontSide","depthWrite","receiveShadow","idsToRemove","animations","tracks","forEach","t","i","includes","push","splice","getObjectByName","length","mixer","AnimationMixer","action","clipAction","play","event","clientX","currentTarget","clientWidth","clientY","clientHeight","x","y","requestAnimationFrame","previousRAF","timeElapsed","_Step","render","delta","update","cleanup","cancelAnimationFrame","removeEventListener","dispose","mounted","beforeUnmount"],"sources":["src/components/LicoBadge.vue"],"sourcesContent":["<template>\n  <div ref=\"threeContainer\" class=\"lico-badge three-container\"></div>\n</template>\n\n<script>\nimport * as THREE from \"three\";\nimport { GLTFLoader } from \"three/examples/jsm/loaders/GLTFLoader\";\n\nexport default {\n  name: \"LicoBadge\",\n  data() {\n    return {\n      threejs: null,\n      scene: null,\n      camera: null,\n      mixers: [],\n      neckBone: null,\n      mouse: new THREE.Vector2(),\n      rafId: null,\n    };\n  },\n  props: {\n    width: { type: Number, default: 64 },\n  },\n  methods: {\n    initialize() {\n      // Create renderer\n      this.threejs = new THREE.WebGLRenderer({\n        antialias: true,\n        alpha: true, // Enables transparency\n      });\n      this.threejs.shadowMap.enabled = true;\n      this.threejs.shadowMap.type = THREE.PCFSoftShadowMap;\n      this.threejs.setPixelRatio(window.devicePixelRatio);\n      this.threejs.setSize(width*1.8,width*1.8);\n      this.threejs.setClearColor(0x000000, 0);\n\n      // Attach renderer to DOM\n      this.$refs.threeContainer.appendChild(this.threejs.domElement);\n\n      // Camera setup\n      const fov = 50;\n      const aspect = 1;\n      const near = 1;\n      const far = 1000.0;\n      this.camera = new THREE.PerspectiveCamera(fov, aspect, near, far);\n      this.camera.position.set(0, 0.5, 2.3);\n      this.camera.lookAt(new THREE.Vector3(0, 0.6, 0));\n\n      // Scene setup\n      this.scene = new THREE.Scene();\n      this.scene.background = null; // Ensures transparency\n\n      // Lights\n      let light = new THREE.DirectionalLight(0xFFFFFF, 4.0);\n      light.position.set(5, 10, 7.5);\n      light.target.position.set(0, 0, 0);\n      light.castShadow = true;\n      light.shadow.bias = 0;\n      light.shadow.mapSize.width = 2048;\n      light.shadow.mapSize.height = 2048;\n      light.shadow.camera.near = 1;\n      light.shadow.camera.far = 500;\n      light.shadow.camera.left = -5;\n      light.shadow.camera.right = 5;\n      light.shadow.camera.top = 5;\n      light.shadow.camera.bottom = -5;\n      this.scene.add(light);\n\n      light = new THREE.AmbientLight(0x846E62, 5.0);\n      this.scene.add(light);\n\n\n      // Load model\n      this.loadModel();\n\n      // Mouse move listener\n      this.threejs.domElement.addEventListener(\n        \"mousemove\",\n        this.onMouseMove,\n        false\n      );\n\n\n      // Start render loop\n      this.raf();\n\n      \n    },\n    loadModel() {\n      const loader = new GLTFLoader();\n      console.log(loader);\n      loader.load(\"/lico-idle.glb\", (gltf) => {\n        gltf.scene.traverse((c) => {\n          if (c.material) {\n            c.material.side = THREE.FrontSide;\n            c.material.depthWrite = true;\n          }\n          c.receiveShadow = true;\n          c.castShadow = c.name !== \"floor\";\n\n          // if (c.name && c.name == \"floor\") {\n          //   c.material.color.set(0x00ff00);\n          // }\n        });\n\n          const idsToRemove = [];\n          gltf.animations[0].tracks.forEach((t, i) => {\n            if (t.name.includes(\"mixamorigHead.quaternion\")) {\n              idsToRemove.push(i);\n            }\n          });\n          idsToRemove.forEach((i) => {\n            gltf.animations[0].tracks.splice(i, 1);\n          });\n\n        this.scene.add(gltf.scene);\n        // this.scene.background = new THREE.Color(0xffffff, 0);\n        // this.renderer.setClearColor(0xffffff, 0);\n\n        this.neckBone = gltf.scene.getObjectByName(\"mixamorigHead\");\n\n        if (gltf.animations.length > 0) {\n          const mixer = new THREE.AnimationMixer(gltf.scene);\n          const action = mixer.clipAction(gltf.animations[0]);\n          action.play();\n\n          // Update the mixer on every frame\n          this.mixers = [mixer];\n        }\n      });\n    },\n    onMouseMove(event) {\n        this.mouse.set(\n          (event.clientX / event.currentTarget.clientWidth) * 2 - 1,\n          -(event.clientY / event.currentTarget.clientHeight) * 2 + 1\n        );\n        if (this.neckBone) {\n          this.neckBone.lookAt(this.mouse.x / 2, (this.mouse.y + 0.8) / 2, 1);\n        }\n    },\n    raf() {\n      this.rafId = requestAnimationFrame((t) => {\n        if (this.previousRAF === null) {\n          this.previousRAF = t;\n        }\n\n        this.raf();\n\n        const timeElapsed = t - this.previousRAF;\n        this.previousRAF = t;\n\n        this._Step(timeElapsed);\n        this.threejs.render(this.scene, this.camera);\n      });\n    },\n    _Step(timeElapsed) {\n      const delta = timeElapsed * 0.001;\n      if (this.mixers.length > 0) {\n        this.mixers[0].update(delta);\n      }\n    },\n    cleanup() {\n      cancelAnimationFrame(this.rafId);\n      this.threejs.domElement.removeEventListener(\n        \"mousemove\",\n        this.onMouseMove\n      );\n      this.threejs.dispose();\n      this.scene = null;\n      this.camera = null;\n      this.mixers = [];\n    },\n  },\n  mounted() {\n    this.initialize();\n  },\n  beforeUnmount() {\n    this.cleanup();\n  },\n};\n</script>\n\n<style lang=\"scss\">\n.three-container {\n  width: width;\n  height: width;\n  border-radius: 9999px;\n  background-color: $color-secondary-500;\n  overflow: hidden;\n\n  canvas {\n    display: block;\n    width: width*1.8;\n    height: width*1.8;\n    position: relative;\n    left: -320px;\n    top: -120px;\n  }\n}\n</style>"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}