{"ast":null,"code":"import \"core-js/modules/es.array.push.js\";\nimport \"core-js/modules/esnext.iterator.constructor.js\";\nimport \"core-js/modules/esnext.iterator.for-each.js\";\nimport \"core-js/modules/esnext.iterator.map.js\";\nexport default {\n  name: 'LicoBadge',\n  props: {\n    msg: String\n  }\n};\nimport * as THREE from 'three';\n\n//import {FBXLoader} from 'three/examples/jsm/loaders/FBXLoader.js';\nimport { GLTFLoader } from 'three/examples/jsm/loaders/GLTFLoader.js';\n//import {OrbitControls} from 'three/examples/jsm/controls/OrbitControls.js';\n\nclass LoadModelDemo {\n  constructor() {\n    this._Initialize();\n  }\n  _Initialize() {\n    this._threejs = new THREE.WebGLRenderer({\n      antialias: true\n    });\n    this._threejs.shadowMap.enabled = true;\n    this._threejs.shadowMap.type = THREE.PCFSoftShadowMap;\n    this._threejs.setPixelRatio(window.devicePixelRatio);\n    this._threejs.setSize(window.innerWidth, window.innerHeight);\n    document.body.appendChild(this._threejs.domElement);\n\n    // window.addEventListener('resize', () => {\n    //   this._OnWindowResize();\n    // }, false);\n\n    const fov = 50;\n    const aspect = 1920 / 1080;\n    const near = 1;\n    const far = 1000.0;\n    this._camera = new THREE.PerspectiveCamera(fov, aspect, near, far);\n    this._camera.position.set(0, 0.5, 2.3);\n    this._camera.lookAt(new THREE.Vector3(0, 0.6, 0));\n    this._scene = new THREE.Scene();\n    let light = new THREE.DirectionalLight(0xFFFFFF, 4.0);\n    light.position.set(5, 10, 7.5);\n    light.target.position.set(0, 0, 0);\n    light.castShadow = true;\n    light.shadow.bias = 0;\n    light.shadow.mapSize.width = 2048;\n    light.shadow.mapSize.height = 2048;\n    light.shadow.camera.near = 1;\n    light.shadow.camera.far = 500;\n    light.shadow.camera.left = -5;\n    light.shadow.camera.right = 5;\n    light.shadow.camera.top = 5;\n    light.shadow.camera.bottom = -5;\n    this._scene.add(light);\n    light = new THREE.AmbientLight(0x846E62, 5.0);\n    this._scene.add(light);\n\n    /*\n        const controls = new OrbitControls(\n          this._camera, this._threejs.domElement);\n    */\n\n    // this._OnWindowResize();\n\n    this._mixers = [];\n    this._previousRAF = null;\n    this.action = [];\n    this.playing = 0;\n    this.headAction = [0];\n    this.neckBone = null;\n    this.mouse = new THREE.Vector2();\n    this._LoadModel();\n    this._threejs.domElement.addEventListener('mousemove', event => this._onMouseMove(event), false);\n    this._RAF();\n  }\n  _LoadModel() {\n    const loader = new GLTFLoader();\n    loader.load('lico-badge/public/lico-actions-subd.glb', gltf => {\n      gltf.scene.traverse(c => {\n        if (c.material) {\n          c.material.side = THREE.FrontSide;\n          c.material.depthWrite = true;\n        }\n        c.receiveShadow = true;\n        if (c.name == \"floor\") c.castShadow = false;else c.castShadow = true;\n      });\n      this.headAction.forEach(i => {\n        const idsToRemove = [];\n        gltf.animations[i].tracks.forEach((t, j) => {\n          if (t.name.includes('mixamorigHead.quaternion')) {\n            idsToRemove.push(j);\n          }\n        });\n        idsToRemove.forEach(j => {\n          console.log('removing ' + i + ' ' + j);\n          gltf.animations[i].tracks.splice(j, 1);\n        });\n      });\n      const m = new THREE.AnimationMixer(gltf.scene);\n      this._mixers.push(m);\n      gltf.animations.forEach((element, i) => {\n        this.action[i] = m.clipAction(element);\n      });\n      this.action[0].play();\n      this.playing = 0;\n      this._scene.add(gltf.scene);\n      this.neckBone = gltf.scene.getObjectByName('mixamorigHead');\n    });\n  }\n  _onMouseMove(event) {\n    if (this.headAction.includes(this.playing)) {\n      this.mouse.set(event.clientX / event.currentTarget.clientWidth * 2 - 1, -(event.clientY / event.currentTarget.clientHeight) * 2 + 1);\n      this.neckBone && this.neckBone.lookAt(this.mouse.x / 2, (this.mouse.y + 0.8) / 2, 1);\n    }\n  }\n\n  // _OnWindowResize() {\n  //   this._camera.aspect = window.innerWidth / window.innerHeight;\n  //   this._camera.updateProjectionMatrix();\n  //   this._threejs.setSize(window.innerWidth, window.innerHeight);\n  // }\n\n  _RAF() {\n    requestAnimationFrame(t => {\n      if (this._previousRAF === null) {\n        this._previousRAF = t;\n      }\n      this._RAF();\n      this._threejs.render(this._scene, this._camera);\n      this._Step(t - this._previousRAF);\n      this._previousRAF = t;\n    });\n  }\n  _Step(timeElapsed) {\n    const timeElapsedS = timeElapsed * 0.001;\n    if (this._mixers) {\n      this._mixers.map(m => m.update(timeElapsedS));\n    }\n    if (this._controls) {\n      this._controls.Update(timeElapsedS);\n    }\n  }\n}\nlet _APP = null;\n_APP = new LoadModelDemo();\n\n// let _APP = null;\n\n// window.addEventListener('DOMContentLoaded', () => {\n//   _APP = new LoadModelDemo();\n// });","map":{"version":3,"names":["name","props","msg","String","THREE","GLTFLoader","LoadModelDemo","constructor","_Initialize","_threejs","WebGLRenderer","antialias","shadowMap","enabled","type","PCFSoftShadowMap","setPixelRatio","window","devicePixelRatio","setSize","innerWidth","innerHeight","document","body","appendChild","domElement","fov","aspect","near","far","_camera","PerspectiveCamera","position","set","lookAt","Vector3","_scene","Scene","light","DirectionalLight","target","castShadow","shadow","bias","mapSize","width","height","camera","left","right","top","bottom","add","AmbientLight","_mixers","_previousRAF","action","playing","headAction","neckBone","mouse","Vector2","_LoadModel","addEventListener","event","_onMouseMove","_RAF","loader","load","gltf","scene","traverse","c","material","side","FrontSide","depthWrite","receiveShadow","forEach","i","idsToRemove","animations","tracks","t","j","includes","push","console","log","splice","m","AnimationMixer","element","clipAction","play","getObjectByName","clientX","currentTarget","clientWidth","clientY","clientHeight","x","y","requestAnimationFrame","render","_Step","timeElapsed","timeElapsedS","map","update","_controls","Update","_APP"],"sources":["src/components/LicoBadge.vue"],"sourcesContent":["<template>\n  <div class=\"lico-badge\">\n    Helooooo!\n  </div>\n</template>\n\n<script>\n\nexport default {\n  name: 'LicoBadge',\n  props: {\n    msg: String\n  }\n}\n\nimport * as THREE from 'three';\n\n//import {FBXLoader} from 'three/examples/jsm/loaders/FBXLoader.js';\nimport {GLTFLoader} from 'three/examples/jsm/loaders/GLTFLoader.js';\n//import {OrbitControls} from 'three/examples/jsm/controls/OrbitControls.js';\n\nclass LoadModelDemo {\n  constructor() {\n    this._Initialize();\n  }\n\n  _Initialize() {\n    this._threejs = new THREE.WebGLRenderer({\n      antialias: true,\n    });\n    this._threejs.shadowMap.enabled = true;\n    this._threejs.shadowMap.type = THREE.PCFSoftShadowMap;\n    this._threejs.setPixelRatio(window.devicePixelRatio);\n    this._threejs.setSize(window.innerWidth, window.innerHeight);\n\n    document.body.appendChild(this._threejs.domElement);\n\n    // window.addEventListener('resize', () => {\n    //   this._OnWindowResize();\n    // }, false);\n\n    const fov = 50;\n    const aspect = 1920 / 1080;\n    const near = 1;\n    const far = 1000.0;\n    this._camera = new THREE.PerspectiveCamera(fov, aspect, near, far);\n    this._camera.position.set(0, 0.5, 2.3);\n    this._camera.lookAt(new THREE.Vector3(0, 0.6, 0));\n\n    this._scene = new THREE.Scene();\n\n\n    let light = new THREE.DirectionalLight(0xFFFFFF, 4.0);\n    light.position.set(5, 10, 7.5);\n    light.target.position.set(0, 0, 0);\n    light.castShadow = true;\n    light.shadow.bias = 0;\n    light.shadow.mapSize.width = 2048;\n    light.shadow.mapSize.height = 2048;\n    light.shadow.camera.near = 1;\n    light.shadow.camera.far = 500;\n    light.shadow.camera.left = -5;\n    light.shadow.camera.right = 5;\n    light.shadow.camera.top = 5;\n    light.shadow.camera.bottom = -5;\n    this._scene.add(light);\n\n    light = new THREE.AmbientLight(0x846E62, 5.0);\n    this._scene.add(light);\n\n/*\n    const controls = new OrbitControls(\n      this._camera, this._threejs.domElement);\n*/\n\n    // this._OnWindowResize();\n\n    this._mixers = [];\n    this._previousRAF = null;\n    this.action = [];\n    this.playing = 0;\n    this.headAction = [0];\n    this.neckBone = null;\n    this.mouse = new THREE.Vector2();\n    this._LoadModel();\n    this._threejs.domElement.addEventListener('mousemove', (event) => this._onMouseMove(event), false);\n    this._RAF();\n  }\n\n  _LoadModel() {\n    const loader = new GLTFLoader();\n    loader.load('lico-badge/public/lico-actions-subd.glb', (gltf) => {\n      gltf.scene.traverse(c => {\n        if (c.material) {\n          c.material.side = THREE.FrontSide;\n          c.material.depthWrite = true;\n        }\n        c.receiveShadow = true;\n        if (c.name == \"floor\")\n          c.castShadow = false;\n        else\n          c.castShadow = true;\n\n\n      });\n\n      this.headAction.forEach((i) => {\n        const idsToRemove = [];\n\n        gltf.animations[i].tracks.forEach((t, j) => {\n            if (t.name.includes('mixamorigHead.quaternion')) {\n              idsToRemove.push(j);\n            }\n        });\n  \n        idsToRemove.forEach((j) => {\n            console.log('removing ' + i + ' ' + j)\n            gltf.animations[i].tracks.splice(j, 1)\n        });\n      });\n\n      const m = new THREE.AnimationMixer( gltf.scene );\n      this._mixers.push(m);\n      gltf.animations.forEach((element,i) => {\n        this.action[i] = m.clipAction( element );\n      });\n      this.action[0].play();\n      this.playing = 0;\n\n      this._scene.add(gltf.scene);\n      this.neckBone = gltf.scene.getObjectByName('mixamorigHead');\n    });\n\n  }\n  _onMouseMove(event) {\n    if (this.headAction.includes(this.playing)){\n      this.mouse.set(\n          (event.clientX / event.currentTarget.clientWidth) * 2 - 1,\n          -(event.clientY / event.currentTarget.clientHeight) * 2 + 1\n      );\n\n      this.neckBone && this.neckBone.lookAt(this.mouse.x / 2, (this.mouse.y + 0.8) / 2, 1);\n    }\n  }\n\n  // _OnWindowResize() {\n  //   this._camera.aspect = window.innerWidth / window.innerHeight;\n  //   this._camera.updateProjectionMatrix();\n  //   this._threejs.setSize(window.innerWidth, window.innerHeight);\n  // }\n\n  _RAF() {\n    requestAnimationFrame((t) => {\n      if (this._previousRAF === null) {\n        this._previousRAF = t;\n      }\n\n      this._RAF();\n\n      this._threejs.render(this._scene, this._camera);\n      this._Step(t - this._previousRAF);\n      this._previousRAF = t;\n    });\n  }\n\n  _Step(timeElapsed) {\n    const timeElapsedS = timeElapsed * 0.001;\n    if (this._mixers) {\n      this._mixers.map(m => m.update(timeElapsedS));\n    }\n\n    if (this._controls) {\n      this._controls.Update(timeElapsedS);\n    }\n  }\n}\n\nlet _APP = null;\n_APP = new LoadModelDemo();\n\n\n// let _APP = null;\n\n\n// window.addEventListener('DOMContentLoaded', () => {\n//   _APP = new LoadModelDemo();\n// });\n\n\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\nh3 {\n  margin: 40px 0 0;\n}\nul {\n  list-style-type: none;\n  padding: 0;\n}\nli {\n  display: inline-block;\n  margin: 0 10px;\n}\na {\n  color: #42b983;\n}\n</style>\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}